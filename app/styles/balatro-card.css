.balatro-card {
  --card-radius: 0.75rem; /* rounded-xl */
  /* Remove fixed avatar-size, rely on container or content */

  touch-action: none;
  isolation: isolate;
  /* max-width: max-content; */
  /* margin-block: 1.5rem; */
  /* padding: var(--avatar-padding); */
  border-radius: var(--card-radius);

  --t: 2px;
  --k: 0.05turn;
  --transform: translate(calc(var(--t) * var(--x)), calc(var(--t) * var(--y)))
    rotateY(calc(var(--k) * var(--x))) rotateX(calc(var(--k) * var(--y)));

  display: block; /* changed from flex to block to act as a normal container */
  position: relative;
  background-color: transparent;
  /* The actual background color will be handled by the background layer or the component inside */
}

/* Layers */
.balatro-card [data-element="background"],
.balatro-card [data-element="rainbow"],
.balatro-card [data-element="shine"] {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border-radius: var(--card-radius);
  pointer-events: none;
}

.balatro-card [data-element="background"] {
  z-index: 1;
  background-color: white; /* Default background */
}
/* Dark mode support logic could be added here or via tailwind classes on the background element */
:is(.dark .balatro-card) [data-element="background"] {
  background-color: #1f2937; /* gray-800 */
}

.balatro-card [data-element="rainbow"] {
  z-index: 2;
}

.balatro-card [data-element="shine"] {
  z-index: 3;
}

.balatro-card [data-element="content"] {
  z-index: 4;
  position: relative;
  transform: var(
    --transform
  ); /* Apply 3D transform to content as well? Or just the card container? */
  /* The reference applies transform to the 'img' and other non-image elements subtly differently. 
     Let's try applying transform to a content wrapper. */
}

/* Interaction States */

.balatro-card[data-state="outside"] [data-element="content"],
.balatro-card[data-state="outside"] [data-element="background"] {
  transition-timing-function: ease;
  transition-duration: 500ms;
  transition-property: transform, box-shadow;
}

.balatro-card[data-state="inside"] [data-element="content"] {
  transform: var(--transform);
  /* Add shadow logic here if needed, adapted for rectangle */
  --k1: calc(-1 / 8);
  --k2: calc(1 / 16);
  /* Simplified shadow for rectangle */
  box-shadow: calc(var(--k1) * 20px * var(--x))
    calc(var(--k1) * 20px * var(--y)) 20px #0002;
}

.balatro-card[data-state="inside"] [data-element="background"] {
  transform: var(--transform);
}

/* Shine and Rainbow */

.balatro-card [data-element="shine"],
.balatro-card [data-element="rainbow"] {
  opacity: 0;
  /* Removed clip-path: circle(50%) */
  border-radius: var(--card-radius);
  transition: opacity 500ms;
}

.balatro-card[data-state="inside"] [data-element="shine"],
.balatro-card[data-state="inside"] [data-element="rainbow"] {
  opacity: 1;
  /* Apply transform to these too so they tilt with the card */
  transform: var(--transform);
}

.balatro-card [data-element="shine"] {
  mix-blend-mode: hard-light;

  /* Default Shine (Clean/Subtle) - Removed Wave Pattern */
  background: transparent;
}

.balatro-card [data-element="rainbow"] {
  mix-blend-mode: hard-light;
  background: linear-gradient(
      var(--angle),
      hsl(var(--angle) 100% 80% / 70%),
      hsl(var(--angle) 100% 80% / 10%) calc(100% * var(--r))
    )
    0 0 / 100% 100%;
}


/* --- VARIANTS --- */

/* Normal: Clean, no holographic effects */
.balatro-card[data-variant="normal"] [data-element="shine"],
.balatro-card[data-variant="normal"] [data-element="rainbow"] {
  display: none !important;
  opacity: 0 !important;
}

/* Foil: Blue-ish, Circular/Interference Pattern */
.balatro-card[data-variant="foil"] [data-element="shine"] {
  mix-blend-mode: hard-light;
  opacity: 0.6;
  --c1: hsl(220 60% 70%); /* Light Blue */
  --c2: hsl(220 60% 40%); /* Dark Blue */
  
  /* Concentric circles / Interference pattern */
  background: repeating-radial-gradient(
    circle at 50% 50%,
    var(--c1) 0%,
    var(--c2) 1px,
    transparent 2px,
    transparent 4px
  );
  background-size: 100% 100%;
}
.balatro-card[data-variant="foil"] [data-element="rainbow"] {
  opacity: 0.2; 
}


/* Holographic: Red-ish, Diamond/Grid Pattern */
.balatro-card[data-variant="holographic"] [data-element="shine"] {
  mix-blend-mode: hard-light;
  --s: 60px; /* Larger size for visibility */
  --c1: hsl(0 60% 70%); /* Light Red */
  --c2: hsl(0 60% 40%); /* Dark Red */
  --line-width: 2px; /* Thickness of the diamond lines */

  /* Diagonal cross-hatch creating diamonds */
  background: 
    linear-gradient(135deg, transparent calc(50% - var(--line-width)), var(--c1) 50%, transparent calc(50% + var(--line-width))),
    linear-gradient(45deg, transparent calc(50% - var(--line-width)), var(--c2) 50%, transparent calc(50% + var(--line-width)));
  background-size: var(--s) var(--s);
}
.balatro-card[data-variant="holographic"] [data-element="rainbow"] {
    opacity: 0.5;
}


/* Polychrome: Strong Rainbow + Noise Texture */
.balatro-card[data-variant="polychrome"] [data-element="shine"] {
    display: block; /* Enable shine for texture */
    mix-blend-mode: overlay;
    opacity: 0.4;
    
    /* Noise / Grain Pattern */
    background-image: radial-gradient(circle, #000 0.5px, transparent 1px);
    background-size: 4px 4px;
}
.balatro-card[data-variant="polychrome"] [data-element="rainbow"] {
  opacity: 0.9;
  mix-blend-mode: hard-light; 
  filter: brightness(1.2) contrast(1.2) saturate(1.5);
}


/* Negative: Inverted */
.balatro-card[data-variant="negative"] {
    filter: invert(1);
    /* Removed manual background-color black override so invert(1) works correctly on the white default */
}

@media (prefers-reduced-motion: reduce) {
  .balatro-card {
    --k: 0turn;
  }
}
